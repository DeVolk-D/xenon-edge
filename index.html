
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Stock Ticker</title>
<style>
  /* ----- Theme ----- */
  :root{
    --bg:#0b0f14; --fg:#e6edf3; --muted:#94a3b8;
    --up:#22c55e; --down:#ef4444;

    /* Responsive sizing: scales with widget/iframe size */
    --font: clamp(14px, 4.2vh, 32px);
    --gap: clamp(10px, 2.6vh, 36px);
    --padY: clamp(6px, 1.8vh, 20px);
    --padX: clamp(10px, 2.4vw, 36px);

    /* Marquee duration (JS updates this per content width) */
    --duration: 55s;
  }

  /* Fill the entire iframe (iCUE widget) */
  html,body{height:100%;width:100%;margin:0;overflow:hidden;background:var(--bg);color:var(--fg);font:var(--font)/1.35 ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}

  /* Center vertically, full-bleed horizontally */
  .wrap{height:100%;display:flex;align-items:center;justify-content:flex-start;white-space:nowrap}
  .ticker{display:inline-flex;gap:var(--gap);padding:var(--padY) var(--padX);animation:scroll var(--duration) linear infinite}

  .item{display:inline-flex;gap:0.6em;align-items:baseline}
  .sym{font-weight:700;color:var(--muted);letter-spacing:.3px}
  .px{font-weight:600}
  .chg.up{color:var(--up)} .chg.down{color:var(--down)}
  .sep{color:#233142}

  /* Smooth infinite scroll */
  @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}

  /* Tap/click to pause/resume */
  .paused{animation-play-state:paused}
</style>
</head>
<body>
  <!-- Full-bleed ticker (no header bar) -->
  <div class="wrap" id="wrap">
    <div class="ticker" id="ticker"></div>
  </div>

<script>
/* ===== CONFIG ===== */
const SYMBOLS = ["AAPL","MSFT","NVDA","AMZN","GOOGL","META","TSLA","AMD","NFLX","CRM"]; // edit as needed
const FINNHUB_TOKEN = "d5ir5q9r01qicq2kb2r0d5ir5q9r01qicq2kb2rg"; // <-- paste your Finnhub key
const REFRESH_MS = 15 * 60 * 1000; // refresh every 15 minutes
const QUOTE_URL = s => `https://finnhub.io/api/v1/quote?symbol=${encodeURIComponent(s)}&token=${FINNHUB_TOKEN}`;

/* ===== FETCH & RENDER ===== */
async function fetchQuote(sym){
  const res = await fetch(QUOTE_URL(sym));
  const q = await res.json(); // { c,d,dp,pc,... }
  const price = Number(q.c ?? 0);
  let change = Number(q.d ?? 0);
  let pct = Number(q.dp ?? 0);

  // Compute pct if missing, using previous close
  if (!Number.isFinite(pct) && Number.isFinite(q.pc) && q.pc !== 0) {
    change = price - q.pc;
    pct = (change / q.pc) * 100;
  }
  return { sym, price, change, pct };
}

async function refresh(){
  const results = [];
  // Gentle pacing well under Finnhub free-tier limits (60 calls/min)
  for (const s of SYMBOLS){
    try { results.push(await fetchQuote(s)); }
    catch(e){ results.push({ sym:s, price:0, change:0, pct:0 }); }
    await new Promise(r=>setTimeout(r, 250));
  }

  const parts = results.map(r=>{
    const dir = r.change >= 0 ? "up" : "down";
    const chg = `${r.change>=0?"+":"-"}${Math.abs(r.change).toFixed(2)} (${r.pct.toFixed(2)}%)`;
    return `<div class="item">
      <span class="sym">${r.sym}</span>
      <span class="px">$${r.price.toFixed(2)}</span>
      <span class="chg ${dir}">${chg}</span>
    </div><span class="sep">â€¢</span>`;
  });

  const el = document.getElementById("ticker");
  el.innerHTML = parts.join("") + parts.join(""); // duplicate for seamless scroll

  // Auto-calc animation duration so speed feels right at any size
  // Measure the first half (before duplication)
  const temp = document.createElement("div");
  temp.style.cssText = "position:absolute;visibility:hidden;white-space:nowrap;";
  temp.innerHTML = parts.join("");
  document.body.appendChild(temp);
  const contentWidth = temp.getBoundingClientRect().width;
  document.body.removeChild(temp);

  const viewportWidth = window.innerWidth;
  const pxPerSecond = Math.max(60, Math.min(140, viewportWidth / 18)); // adaptive speed
  const durationSec = (contentWidth + viewportWidth) / pxPerSecond;

  document.documentElement.style.setProperty("--duration", `${durationSec.toFixed(2)}s`);
}

refresh();
setInterval(refresh, REFRESH_MS);

/* Tap/click to pause/resume the marquee */
document.getElementById("wrap").addEventListener("click", ()=>{
  document.getElementById("ticker").classList.toggle("paused");
});

/* Recompute duration on resize (widget size changes) */
window.addEventListener("resize", ()=>{
  // Only recompute duration; skip data fetch
  const el = document.getElementById("ticker");
  if (!el.innerHTML) return;

  const firstHalf = el.innerHTML.slice(0, el.innerHTML.length / 2);
  const t = document.createElement("div");
  t.style.cssText = "position:absolute;visibility:hidden;white-space:nowrap;";
  t.innerHTML = firstHalf;
  document.body.appendChild(t);
  const w = t.getBoundingClientRect().width;
  document.body.removeChild(t);

  const vw = window.innerWidth;
  const s = Math.max(60, Math.min(140, vw / 18));
  const dur = (w + vw) / s;
  document.documentElement.style.setProperty("--duration", `${dur.toFixed(2)}s`);
});
</script>
</body>
</html>
