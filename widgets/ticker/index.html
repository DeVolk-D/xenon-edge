
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EDGE Ticker</title>
<style>
  /* ----- Theme & aggressive sizing for 2560×720 ----- */
  :root{
    --bg:#0b0f14; --fg:#e6edf3; --muted:#cbd5e1;          /* brighter muteds for contrast */
    --up:#22c55e; --down:#ef4444;

    /* Big responsive type for full-height EDGE */
    /* 720px height → 10–12vh ≈ 72–86px; clamp gives room across layouts */
    --font: clamp(32px, 11.5vh, 110px);
    --gap: clamp(18px, 3.2vh, 46px);                      /* spacing between items */
    --padX: clamp(12px, 2.0vw, 40px);                     /* small horizontal breathing room */

    /* Auto-updated by JS based on content width */
    --duration: 55s;
  }

  /* Fill the entire iframe (iCUE widget) with no extra space */
  html, body { height:100%; width:100%; margin:0; overflow:hidden;
               background:var(--bg); color:var(--fg);
               font: var(--font)/1.15 ui-sans-serif, system-ui, Segoe UI, Roboto, Arial; }

  /* Full-bleed ticker row; NO vertical padding */
  .wrap { height:100%; display:flex; align-items:center; justify-content:flex-start; white-space:nowrap; }
  .ticker { display:inline-flex; gap:var(--gap); padding:0 var(--padX);
            animation:scroll var(--duration) linear infinite; }

  .item { display:inline-flex; gap:0.6em; align-items:baseline }
  .sym  { font-weight:800; color:var(--muted); letter-spacing:.3px }
  .px   { font-weight:700 }
  .chg.up   { color:var(--up) }
  .chg.down { color:var(--down) }
  .sep  { color:#233142 } /* thin separator dot */

  @keyframes scroll { from{ transform:translateX(0) } to{ transform:translateX(-50%) } }
  .paused { animation-play-state:paused }
</style>
</head>
<body>
  <!-- Full-bleed ticker (no header, no top/bottom padding) -->
  <div class="wrap" id="wrap">
    <div class="ticker" id="ticker"></div>
  </div>

<script>
/* ===== Automatic cache-buster: add ?v=<timestamp> once ===== */
(function () {
  try {
    const u = new URL(window.location.href);
    if (!u.searchParams.has('v')) {
      u.searchParams.set('v', String(Date.now()));        // bust cache
      window.location.replace(u.toString());              // one-time reload
    }
  } catch (e) {}
})();

/* ===== CONFIG ===== */
const SYMBOLS = ["AAPL","MSFT","NVDA","AMZN","GOOGL","META","TSLA","AMD","NFLX","CRM"]; // edit as needed
const FINNHUB_TOKEN = "d5ir5q9r01qicq2kb2r0d5ir5q9r01qicq2kb2rg"; // <-- paste your Finnhub key
const REFRESH_MS = 15 * 60 * 1000;          // refresh every 15 minutes
const QUOTE_URL = s => `https://finnhub.io/api/v1/quote?symbol=${encodeURIComponent(s)}&token=${FINNHUB_TOKEN}`;

/* ===== FETCH & RENDER ===== */
async function fetchQuote(sym){
  const res = await fetch(QUOTE_URL(sym));
  const q = await res.json(); // { c,d,dp,pc,... }
  const price = Number(q.c ?? 0);
  let change = Number(q.d ?? 0);
  let pct = Number(q.dp ?? 0);

  // Compute pct if missing, using previous close
  if (!Number.isFinite(pct) && Number.isFinite(q.pc) && q.pc !== 0) {
    change = price - q.pc;
    pct = (change / q.pc) * 100;
  }
  return { sym, price, change, pct };
}

/* Build one pass and duplicate for infinite marquee */
async function refresh(){
  const results = [];
  for (const s of SYMBOLS){
    try { results.push(await fetchQuote(s)); }
    catch(e){ results.push({ sym:s, price:0, change:0, pct:0 }); }
    await new Promise(r=>setTimeout(r, 250));            // stay well below Finnhub 60 calls/min limit
  }

  const parts = results.map(r=>{
    const dir = r.change >= 0 ? "up" : "down";
    const chg = `${r.change>=0?"+":"-"}${Math.abs(r.change).toFixed(2)} (${r.pct.toFixed(2)}%)`;
    return `<div class="item">
      <span class="sym">${r.sym}</span>
      <span class="px">$${r.price.toFixed(2)}</span>
      <span class="chg ${dir}">${chg}</span>
    </div><span class="sep">•</span>`;
  });

  const el = document.getElementById("ticker");
  el.innerHTML = parts.join("") + parts.join("");

  /* Auto-calc animation duration so speed feels right at any size */
  const temp = document.createElement("div");
  temp.style.cssText = "position:absolute;visibility:hidden;white-space:nowrap;";
  temp.innerHTML = parts.join("");
  document.body.appendChild(temp);
  const contentWidth = temp.getBoundingClientRect().width;
  document.body.removeChild(temp);

  const vw = window.innerWidth;
  const pxPerSecond = Math.max(80, Math.min(170, vw / 16)); // aggressive speed curve for big type
  const durationSec  = (contentWidth + vw) / pxPerSecond;
  document.documentElement.style.setProperty("--duration", `${durationSec.toFixed(2)}s`);
}

refresh();
setInterval(refresh, REFRESH_MS);

/* Tap/click to pause/resume */
document.getElementById("wrap").addEventListener("click", ()=>{
  document.getElementById("ticker").classList.toggle("paused");
});

/* Recompute duration on resize (for EDGE widget size changes) */
window.addEventListener("resize", ()=>{
  const el = document.getElementById("ticker");
  if (!el.innerHTML) return;
  const half = el.innerHTML.slice(0, el.innerHTML.length / 2);
  const t = document.createElement("div");
  t.style.cssText = "position:absolute;visibility:hidden;white-space:nowrap;";
  t.innerHTML = half;
  document.body.appendChild(t);
  const w = t.getBoundingClientRect().width;
  document.body.removeChild(t);

  const vw = window.innerWidth;
  const s = Math.max(80, Math.min(170, vw / 16));
  const d = (w + vw) / s;
  document.documentElement.style.setProperty("--duration", `${d.toFixed(2)}s`);
});
</script>
</body>
</html>
